# ğŸ§  åˆ›å»ºå®‰å…¨ä¸”ç®€æ´çš„ Master AI æ–‡ä»¶ä¸Šä¼  API
cat << 'PYCODE' > master_ai_uploader_api.py
from flask import Flask, request, jsonify
import os, subprocess
from werkzeug.utils import secure_filename

app = Flask(__name__)

UPLOAD_DIR = "uploaded_docs"
os.makedirs(UPLOAD_DIR, exist_ok=True)

# å…è®¸çš„æ–‡ä»¶ç±»å‹
ALLOWED_EXT = {"md", "txt", "pdf", "docx"}
MAX_SIZE_MB = 10

def allowed_file(filename):
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXT

@app.route("/api/master-ai/upload", methods=["POST"])
def upload_file():
    """ä¸Šä¼ æ–‡ä»¶å¹¶å¯¼å…¥ Lynker Master Vault"""
    if "file" not in request.files:
        return jsonify({"error": "âŒ æœªæ£€æµ‹åˆ°æ–‡ä»¶"}), 400

    f = request.files["file"]
    if f.filename == "":
        return jsonify({"error": "âŒ æ–‡ä»¶åä¸ºç©º"}), 400

    if not allowed_file(f.filename):
        return jsonify({"error": f"âŒ ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: {f.filename}"}), 400

    f.seek(0, os.SEEK_END)
    size_mb = f.tell() / (1024 * 1024)
    f.seek(0)
    if size_mb > MAX_SIZE_MB:
        return jsonify({"error": f"âš ï¸ æ–‡ä»¶è¶…è¿‡ {MAX_SIZE_MB}MB é™åˆ¶"}), 400

    safe_name = secure_filename(f.filename)
    filepath = os.path.join(UPLOAD_DIR, safe_name)
    f.save(filepath)

    # è°ƒç”¨å¯¼å…¥å™¨æ‰§è¡Œè‡ªåŠ¨åˆ†ç±»
    result = subprocess.getoutput(f"python master_ai_importer.py {filepath}")
    return jsonify({
        "status": "âœ… æ–‡ä»¶ä¸Šä¼ å¹¶å¯¼å…¥æˆåŠŸ",
        "filename": safe_name,
        "import_result": result
    })

@app.route("/api/master-ai/context", methods=["GET"])
def get_context():
    """æŸ¥çœ‹ Vault ä¸­çš„æ–‡ä»¶åˆ—è¡¨"""
    context = {}
    for root, dirs, files in os.walk("lynker_master_vault"):
        rel_root = os.path.relpath(root, "lynker_master_vault")
        context[rel_root] = files
    return jsonify(context)

@app.route("/")
def index():
    return "<h3>âœ… Lynker Master Vault Upload API æ­£åœ¨è¿è¡Œ</h3>"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8080)
PYCODE

echo "âœ… å·²åˆ›å»º master_ai_uploader_api.py"
echo "ğŸ¯ å¯åŠ¨å‘½ä»¤ï¼špython master_ai_uploader_api.py"
echo "ğŸŒ æµè§ˆå™¨è®¿é—®ï¼š/api/master-ai/context æŸ¥çœ‹ Vault çŠ¶æ€"
