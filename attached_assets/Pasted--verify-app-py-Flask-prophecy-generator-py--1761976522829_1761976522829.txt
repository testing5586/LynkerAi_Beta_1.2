ğŸ—ï¸ é¡¹ç›®ç»“æ„
/verify
â”‚
â”œâ”€â”€ app.py                         # Flask ä¸»åç«¯
â”œâ”€â”€ prophecy_generator.py           # å‘½ç›˜è§£æ â†’ è‡ªåŠ¨ç”Ÿæˆé¢„è¨€é—®é¢˜
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ verify_wizard.js           # å‰ç«¯é€»è¾‘ä¸äº¤äº’äº‹ä»¶
â”‚   â””â”€â”€ style.css                  # æŒ‰é’®æ ·å¼ä¸çŠ¶æ€åé¦ˆ
â”‚
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ verify.html                # ä¸»é¡µé¢ï¼ˆå«Mode BåŒºåŸŸ+Prophecyé—®é¢˜ï¼‰
â”‚
â””â”€â”€ data/
    â””â”€â”€ prophecy_feedback_log.jsonl # é¢„è¨€éªŒè¯è®°å½•å½’æ¡£

ğŸ§  prophecy_generator.py

è‡ªåŠ¨æ ¹æ®ç´«å¾®å‘½ç›˜ä¸å…«å­—ç»“æ„ç”Ÿæˆé¢„æµ‹é—®é¢˜ã€‚

import re, random, json

def generate_prophecies(ziwei_text: str):
    prophecies = []

    # å…„å¼Ÿå®«ç ´å†›æ“ç¾Š
    if re.search(r"å…„å¼Ÿå®®.*ç ´è»", ziwei_text) and re.search(r"å…„å¼Ÿå®®.*æ“ç¾Š", ziwei_text):
        prophecies.append({
            "palace": "å…„å¼Ÿå®«",
            "question": "ä½ å…„å¼Ÿå®«æ“ç¾Šç ´å†›ï¼Œæ˜¯å¦è¢«å…„å¼Ÿå§å¦¹è¿ç´¯æˆ–å‘ç”Ÿæ„å¤–è¿›é™¢å¼€åˆ€ï¼Ÿ"
        })
    
    # è´¢å¸›å®« ç¦„å¿ŒåŒå®«
    if re.search(r"è´¢å¸›å®®.*ç¦„", ziwei_text) and re.search(r"è´¢å¸›å®®.*å¿Œ", ziwei_text):
        prophecies.append({
            "palace": "è´¢å¸›å®«",
            "question": "ä½ çš„è´¢å¸›å®«ç¦„å¿ŒåŒå®«ï¼Œæ˜¯å¦æ›¾å› ä¿¡ä»»ä»–äººæŠ•èµ„è€Œç ´è´¢ï¼Ÿ"
        })
    
    # å¤«å¦»å®«åŒ–å¿Œ
    if re.search(r"å¤«å¦»å®®.*å¿Œ", ziwei_text):
        prophecies.append({
            "palace": "å¤«å¦»å®«",
            "question": "å¤«å¦»å®«åŒ–å¿Œï¼Œæ˜¯å¦ç»å†è¿‡çªå‘çš„æ„Ÿæƒ…ç ´è£‚æˆ–ç¦»å¼‚ï¼Ÿ"
        })
    
    # ç–¾å„å®«ç«é“ƒå¹¶ä¸´
    if re.search(r"ç–¾å„å®®.*ç«æ˜Ÿ", ziwei_text) and re.search(r"ç–¾å„å®®.*éˆ´æ˜Ÿ", ziwei_text):
        prophecies.append({
            "palace": "ç–¾å„å®«",
            "question": "ç–¾å„å®«ç«é“ƒå¹¶ä¸´ï¼Œæ˜¯å¦æœ‰è¿‡å¼€åˆ€æˆ–çƒ§ä¼¤äº‹æ•…ï¼Ÿ"
        })

    # è¿ç§»å®«å¤©é©¬
    if re.search(r"è¿ç§»å®®.*å¤©é¦¬", ziwei_text):
        prophecies.append({
            "palace": "è¿ç§»å®«",
            "question": "è¿ç§»å®«å¤©é©¬æ˜Ÿæ—ºï¼Œæ˜¯å¦å¸¸å¹´å¥”æ³¢æˆ–æœ‰æµ·å¤–å‘å±•ï¼Ÿ"
        })

    if not prophecies:
        prophecies.append({
            "palace": "ç»¼åˆ",
            "question": "å‘½ç›˜æ˜¾ç¤ºä½ ä¸€ç”Ÿèµ·ä¼è¾ƒå¤§ï¼Œæ˜¯å¦æ›¾ç»å†å¤šæ¬¡é‡å¤§è½¬æŠ˜ï¼Ÿ"
        })
    
    return prophecies

ğŸ§© app.pyï¼ˆFlaskä¸»åç«¯ï¼‰
from flask import Flask, render_template, request, jsonify
from prophecy_generator import generate_prophecies
import json, os, datetime

app = Flask(__name__)

@app.route("/")
def index():
    return render_template("verify.html")

# === [Prophecy Generator] ===
@app.route("/verify/api/run_prophecy_ai", methods=["POST"])
def run_prophecy_ai():
    data = request.get_json()
    ziwei_text = data.get("ziwei_text", "")
    prophecies = generate_prophecies(ziwei_text)
    return jsonify({"ok": True, "prophecies": prophecies})

# === [Record Prophecy Feedback] ===
@app.route("/verify/api/record_prophecy_feedback", methods=["POST"])
def record_prophecy_feedback():
    data = request.get_json()
    os.makedirs("./data", exist_ok=True)
    entry = {
        "user_id": data.get("user_id"),
        "question": data.get("question"),
        "result": data.get("result"),
        "timestamp": datetime.datetime.now().isoformat()
    }
    with open("./data/prophecy_feedback_log.jsonl", "a", encoding="utf-8") as f:
        f.write(json.dumps(entry, ensure_ascii=False) + "\n")
    return jsonify({"ok": True})

# === [Prophecy Statistics] ===
@app.route("/verify/api/prophecy_stats")
def prophecy_stats():
    records = []
    try:
        with open("./data/prophecy_feedback_log.jsonl", "r", encoding="utf-8") as f:
            records = [json.loads(line) for line in f]
    except FileNotFoundError:
        pass
    total = len(records)
    correct = sum(1 for r in records if r["result"] == "å‡†")
    return jsonify({
        "total": total,
        "correct": correct,
        "accuracy": round(correct / total * 100, 2) if total > 0 else 0
    })

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000, debug=True)

ğŸ’» verify_wizard.js

å‰ç«¯ç”Ÿæˆé—®é¢˜ + æŒ‰é’® + å›ä¼ ã€‚

async function runProphecyAI() {
  const ziweiText = document.getElementById("ziwei_textarea").value;
  const response = await fetch("/verify/api/run_prophecy_ai", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ user_id: "1", ziwei_text: ziweiText })
  });
  const data = await response.json();
  if (!data.ok) return alert("âš ï¸ Prophecy AI ç”Ÿæˆå¤±è´¥");
  
  const container = document.getElementById("prophecy_zone");
  container.innerHTML = "";
  data.prophecies.forEach((p, idx) => {
    container.innerHTML += `
      <div class="prophecy-card" data-id="${idx}">
        <p>${p.question}</p>
        <button onclick="recordProphecyFeedback('${idx}', true)">âœ… å‡†</button>
        <button onclick="recordProphecyFeedback('${idx}', false)">âŒ ä¸å‡†</button>
      </div>`;
  });
}

async function recordProphecyFeedback(qid, result) {
  const questionText = document.querySelector(`[data-id='${qid}'] p`).innerText;
  const payload = {
    user_id: "1",
    question: questionText,
    result: result ? "å‡†" : "ä¸å‡†"
  };
  await fetch("/verify/api/record_prophecy_feedback", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });
  document.querySelector(`[data-id='${qid}']`).classList.add(result ? "prophecy-yes" : "prophecy-no");
}

ğŸ§¾ verify.html
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>çœŸå‘½ç›˜éªŒè¯ä¸­å¿ƒ</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <h2>Prophecy Validation Center</h2>
  <textarea id="ziwei_textarea" placeholder="è´´ä¸Šæ–‡å¢¨å¤©æœºç´«å¾®æ–—æ•°å‘½ç›˜æ–‡æœ¬..."></textarea>
  <button onclick="runProphecyAI()">ç”Ÿæˆé¢„è¨€é—®é¢˜</button>
  <div id="prophecy_zone"></div>
  <script src="/static/verify_wizard.js"></script>
</body>
</html>

ğŸ¨ style.css
.prophecy-card {
  border: 1px solid #ccc;
  border-radius: 10px;
  margin: 8px 0;
  padding: 10px;
  transition: 0.3s ease;
}
.prophecy-yes { background: #e7ffe7; }
.prophecy-no { background: #ffe7e7; }
button { margin-right: 10px; cursor: pointer; }

âœ… éƒ¨ç½²åæµ‹è¯•æµç¨‹

1ï¸âƒ£ å¯åŠ¨ Replit â†’ è¿è¡Œ app.py
2ï¸âƒ£ æ‰“å¼€ç½‘é¡µ â†’ ç²˜è´´ä¸€æ®µç´«å¾®å‘½ç›˜æ–‡æœ¬ï¼ˆæ–‡å¢¨å¤©æœºæ ¼å¼ï¼‰
3ï¸âƒ£ ç‚¹å‡»ã€Œç”Ÿæˆé¢„è¨€é—®é¢˜ã€
4ï¸âƒ£ å‡ºç°é¢„è¨€é—®é¢˜ï¼Œæ¯æ¡æœ‰ âœ… / âŒ æŒ‰é’®
5ï¸âƒ£ ç”¨æˆ·ç‚¹é€‰ â†’ è‡ªåŠ¨è®°å½•ç»“æœ
6ï¸âƒ£ è®¿é—® /verify/api/prophecy_stats å¯çœ‹ç»Ÿè®¡å‘½ä¸­ç‡