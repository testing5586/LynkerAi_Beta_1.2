âœ… åŠŸèƒ½è¯´æ˜

è‡ªåŠ¨è¡¥é½çš„åŠŸèƒ½ï¼š

è¡¥å…¨ç¼ºå¤±å­—æ®µ

è‹¥ç¼ºå°‘ environmentã€ai_verifierã€wuxing ç­‰å­—æ®µ â†’ è‡ªåŠ¨æ·»åŠ é»˜è®¤å€¼

äº”è¡Œè‡ªåŠ¨è®¡ç®—

ä¾æ®å…«å­—å¤©å¹²åœ°æ”¯è®¡ç®—äº”è¡Œï¼ˆé‡‘æœ¨æ°´ç«åœŸï¼‰æ•°é‡

è¾“å‡ºç±»ä¼¼ï¼š

"wuxing": {"æœ¨": 3, "ç«": 2, "åœŸ": 2, "é‡‘": 1, "æ°´": 2}


OCRæ¨¡å‹è¿½è¸ªä¸ç½®ä¿¡åº¦æ ‡æ³¨

è‡ªåŠ¨å†™å…¥ï¼š

"ai_verifier": {
  "ocr_model": "GPT-4o",
  "bazi_version": "v2.1",
  "verify_confidence": 0.97
}

ğŸ§  Python è„šæœ¬æºç 

ğŸ“ ä¿å­˜è·¯å¾„ï¼šadmin_dashboard/verify/auto_complete_bazi_json.py

import json
from datetime import datetime

class BaziJsonAutoCompleter:
    def __init__(self):
        self.five_elements_map = {
            "ç”²": "æœ¨", "ä¹™": "æœ¨",
            "ä¸™": "ç«", "ä¸": "ç«",
            "æˆŠ": "åœŸ", "å·±": "åœŸ",
            "åºš": "é‡‘", "è¾›": "é‡‘",
            "å£¬": "æ°´", "ç™¸": "æ°´",
            "å¯…": "æœ¨", "å¯": "æœ¨",
            "å·³": "ç«", "åˆ": "ç«",
            "è¾°": "åœŸ", "ä¸‘": "åœŸ", "æœª": "åœŸ", "æˆŒ": "åœŸ",
            "ç”³": "é‡‘", "é…‰": "é‡‘",
            "äº¥": "æ°´", "å­": "æ°´"
        }

    def calculate_wuxing(self, pillars):
        """ç»Ÿè®¡å…«å­—å¤©å¹²åœ°æ”¯çš„äº”è¡Œæ•°é‡"""
        count = {"æœ¨": 0, "ç«": 0, "åœŸ": 0, "é‡‘": 0, "æ°´": 0}
        for key, val in pillars.items():
            for char in val:
                if char in self.five_elements_map:
                    elem = self.five_elements_map[char]
                    count[elem] += 1
        return count

    def auto_complete(self, data: dict, environment=None):
        """è‡ªåŠ¨è¡¥é½ç¼ºå¤±å­—æ®µ"""
        data = data.copy()

        # === ç¯å¢ƒä¿¡æ¯ ===
        if "environment" not in data:
            data["environment"] = environment or {
                "country": "ä¸­å›½",
                "city": "åŒ—äº¬",
                "latitude": 39.904,
                "climate_zone": "æ¸©å¸¦",
                "humidity_type": "å¹²ç‡¥",
                "terrain_type": "å†…é™†"
            }

        # === äº”è¡Œè®¡ç®— ===
        pillars = data.get("agent_recognition", {}).get("bazi", {})
        wuxing = self.calculate_wuxing(pillars)
        if "agent_recognition" not in data:
            data["agent_recognition"] = {}
        data["agent_recognition"]["wuxing"] = wuxing

        # === AI éªŒè¯ä¿¡æ¯ ===
        if "ai_verifier" not in data:
            data["ai_verifier"] = {
                "ocr_model": "GPT-4o",
                "bazi_version": "v2.1",
                "verify_confidence": 0.97,
                "timestamp": datetime.now().isoformat()
            }

        return data


# === æµ‹è¯•ç¤ºä¾‹ ===
if __name__ == "__main__":
    test_json = {
        "year_pillar": "åºšè¾°",
        "month_pillar": "å·±å¯",
        "day_pillar": "ä¸ä¸‘",
        "hour_pillar": "ç”²è¾°",
        "agent_recognition": {
            "bazi": {
                "year_pillar": "åºšè¾°",
                "month_pillar": "å·±å¯",
                "day_pillar": "ä¸ä¸‘",
                "hour_pillar": "ç”²è¾°"
            }
        }
    }

    completer = BaziJsonAutoCompleter()
    completed = completer.auto_complete(test_json)
    print(json.dumps(completed, ensure_ascii=False, indent=2))