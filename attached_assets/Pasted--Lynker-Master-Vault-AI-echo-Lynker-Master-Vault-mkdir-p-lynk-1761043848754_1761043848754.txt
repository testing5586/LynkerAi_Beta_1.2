# ğŸ§  åˆå§‹åŒ– Lynker Master Vaultï¼ˆçµå®¢æ€»AIçŸ¥è¯†ä»“åº“ï¼‰

echo "ğŸš€ æ­£åœ¨åˆ›å»º Lynker Master Vault ç»“æ„..."

mkdir -p lynker_master_vault/{project_docs,dev_brainstorm,api_docs,memory}
touch lynker_master_vault/index.yaml
echo "âœ… å·²åˆ›å»ºçŸ¥è¯†é‡‘åº“ç›®å½•ç»“æ„"

# âœ¨ åˆ›å»º master_ai_importer.py
cat << 'PYCODE' > master_ai_importer.py
import os, json, shutil
from pathlib import Path
import yaml

BASE_DIR = Path("lynker_master_vault")
INDEX_FILE = BASE_DIR / "index.yaml"

def ensure_dirs():
    (BASE_DIR / "project_docs").mkdir(parents=True, exist_ok=True)
    (BASE_DIR / "dev_brainstorm").mkdir(exist_ok=True)
    (BASE_DIR / "api_docs").mkdir(exist_ok=True)
    (BASE_DIR / "memory").mkdir(exist_ok=True)

def categorize_doc(filename):
    """è‡ªåŠ¨è¯†åˆ«æ–‡æ¡£ç±»åˆ«"""
    lower = filename.lower()
    if any(x in lower for x in ["ui", "design", "dashboard", "client"]):
        return "project_docs"
    if any(x in lower for x in ["api", "auth", "supabase", "drive", "oauth"]):
        return "api_docs"
    if any(x in lower for x in ["ai", "guru", "iron", "å‘½ç†", "åŒå‘½", "ç„å­¦", "å¤ªç„", "é“æ¿"]):
        return "dev_brainstorm"
    return "project_docs"

def import_doc(filepath):
    ensure_dirs()
    if not os.path.exists(filepath):
        print(f"âŒ æ–‡ä»¶ä¸å­˜åœ¨ï¼š{filepath}")
        return
    category = categorize_doc(filepath)
    target = BASE_DIR / category / os.path.basename(filepath)
    shutil.copy(filepath, target)
    update_index(os.path.basename(filepath), category)
    print(f"âœ… å·²å¯¼å…¥ {filepath} â†’ {category}")

def update_index(filename, category):
    """æ›´æ–°å…¨å±€ç´¢å¼•"""
    if INDEX_FILE.exists():
        index = yaml.safe_load(INDEX_FILE.read_text()) or {}
    else:
        index = {}
    index.setdefault(category, [])
    if filename not in index[category]:
        index[category].append(filename)
    INDEX_FILE.write_text(yaml.safe_dump(index, allow_unicode=True))
    print(f"ğŸ“š ç´¢å¼•å·²æ›´æ–° â†’ {INDEX_FILE}")

if __name__ == "__main__":
    import sys
    if len(sys.argv) < 2:
        print("ğŸ“¥ ç”¨æ³•ï¼špython master_ai_importer.py <æ–‡ä»¶è·¯å¾„>")
    else:
        import_doc(sys.argv[1])
PYCODE

# âœ¨ åˆ›å»º master_ai_context_api.py
cat << 'PYCODE' > master_ai_context_api.py
from flask import Flask, jsonify
from pathlib import Path

app = Flask(__name__)

@app.route("/api/master-ai/context", methods=["GET"])
def get_master_context():
    """è¿”å› Lynker Vault çŸ¥è¯†æ‘˜è¦"""
    summaries = []
    for category in ["project_docs", "dev_brainstorm", "api_docs"]:
        path = Path(f"lynker_master_vault/{category}")
        for file in path.glob("*.md"):
            text = file.read_text(errors='ignore')[:500]
            summaries.append({
                "file": file.name,
                "category": category,
                "snippet": text
            })
    return jsonify(summaries)

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8080)
PYCODE

echo "âœ… master_ai_importer.py + context API å·²åˆ›å»ºå®Œæˆ"
echo "ğŸ¯ ä½¿ç”¨æ–¹æ³•ï¼š"
echo "  1ï¸âƒ£ ä¸Šä¼ ä»»æ„ .md / .txt / .pdf æ–‡ä»¶åˆ°é¡¹ç›®æ ¹ç›®å½•"
echo "  2ï¸âƒ£ æ‰§è¡Œï¼špython master_ai_importer.py <æ–‡ä»¶è·¯å¾„>"
echo "  3ï¸âƒ£ Flask API è¿è¡Œåè®¿é—®ï¼š/api/master-ai/context"
echo "  4ï¸âƒ£ å¯ä¸ master_ai_console.html ç»“åˆä½¿ç”¨"
