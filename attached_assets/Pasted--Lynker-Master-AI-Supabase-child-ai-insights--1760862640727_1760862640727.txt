è¯·å¸®æˆ‘åœ¨ Lynker Master AI é¡¹ç›®ä¸­è‡ªåŠ¨åˆ›å»ºå¹¶åŒæ­¥ Supabase äº‘ç«¯è¡¨ child_ai_insightsã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ§± ä»»åŠ¡ç›®æ ‡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1ï¸âƒ£ æ£€æµ‹ Supabase è¿æ¥çŠ¶æ€
2ï¸âƒ£ è‹¥ä¸å­˜åœ¨ child_ai_insights è¡¨ â†’ è‡ªåŠ¨æ‰§è¡Œåˆ›å»ºè¯­å¥
3ï¸âƒ£ è‹¥è¡¨å·²å­˜åœ¨ â†’ è¾“å‡ºç¡®è®¤ âœ…
4ï¸âƒ£ æµ‹è¯•æ’å…¥ä¸è¯»å–é€»è¾‘ï¼Œç¡®ä¿äº‘ç«¯å†™å…¥æˆåŠŸ

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“‹ Supabase è¡¨ç»“æ„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CREATE TABLE IF NOT EXISTS public.child_ai_insights (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id TEXT NOT NULL,
  partner_id TEXT NOT NULL,
  similarity FLOAT,
  shared_tags JSONB,
  insight_text TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- æ€§èƒ½ä¼˜åŒ–ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_child_ai_user_id ON public.child_ai_insights (user_id);
CREATE INDEX IF NOT EXISTS idx_child_ai_partner_id ON public.child_ai_insights (partner_id);
CREATE INDEX IF NOT EXISTS idx_child_ai_similarity ON public.child_ai_insights (similarity);

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš™ï¸ æ‰§è¡Œé€»è¾‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1ï¸âƒ£ åœ¨ supabase_init.py ä¸­å¢åŠ æ£€æµ‹é€»è¾‘ï¼š
def ensure_child_ai_insights_table(supabase):
    """æ£€æŸ¥æˆ–åˆ›å»º child_ai_insights è¡¨"""
    try:
        result = supabase.table("child_ai_insights").select("*").limit(1).execute()
        print("âœ… Table 'child_ai_insights' already exists.")
    except Exception:
        print("ğŸ› ï¸ Creating table 'child_ai_insights' in Supabase...")
        ddl = '''
        CREATE TABLE IF NOT EXISTS public.child_ai_insights (
            id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
            user_id TEXT NOT NULL,
            partner_id TEXT NOT NULL,
            similarity FLOAT,
            shared_tags JSONB,
            insight_text TEXT,
            created_at TIMESTAMP DEFAULT NOW()
        );
        CREATE INDEX IF NOT EXISTS idx_child_ai_user_id ON public.child_ai_insights (user_id);
        CREATE INDEX IF NOT EXISTS idx_child_ai_partner_id ON public.child_ai_insights (partner_id);
        CREATE INDEX IF NOT EXISTS idx_child_ai_similarity ON public.child_ai_insights (similarity);
        '''
        supabase.postgrest.rpc("exec_sql", {"sql": ddl}).execute()
        print("âœ… Table 'child_ai_insights' created successfully!")

2ï¸âƒ£ åœ¨ main.py å¯åŠ¨æ—¶è°ƒç”¨ï¼š
from supabase_init import ensure_child_ai_insights_table
ensure_child_ai_insights_table(supabase_client)

3ï¸âƒ£ æµ‹è¯•å‘½ä»¤ï¼š
python3 -c "from supabase_init import get_supabase, ensure_child_ai_insights_table; s=get_supabase(); ensure_child_ai_insights_table(s)"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¯ é¢„æœŸç»“æœ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¿è¡Œåï¼Œè¾“å‡ºï¼š
ğŸ”— Connected to Supabase!
âœ… Table 'child_ai_insights' created successfully!
æˆ–ï¼š
âœ… Table 'child_ai_insights' already exists.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ§ª éªŒè¯
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ‰§è¡Œï¼š
python child_ai_insight.py

é¢„æœŸè¾“å‡ºï¼š
ğŸ”— Connected to Supabase!
âœ… Table 'child_ai_insights' already exists.
ğŸ’« ä½ ä¸ u_test1 çš„å‘½ç†ç›¸ä¼¼åº¦ä¸º 0.911ã€‚
ğŸ“‹ å…±åŒç‰¹å¾ï¼šè®¾è®¡è¡Œä¸šã€æ™šå©šã€æ¯ç¼˜æµ…ã€‚
ğŸ”® â†’ å‘½æ ¼é«˜åº¦å…±æŒ¯ï¼Œå½¼æ­¤èƒ½æ·±åˆ»ç†è§£ã€‚
