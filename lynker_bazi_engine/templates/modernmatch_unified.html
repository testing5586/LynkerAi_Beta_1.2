{% extends "base_dark.html" %}

{% block title %}æ—¶é—´åŒé¢‘ Â· æ¯«ç§’çº§ç»“æ„åŒ¹é…{% endblock %}

{% block ranking_title %}æ—¶é—´åŒé¢‘æ’è¡Œæ¦œ ğŸ†{% endblock %}

{% block ranking_tabs %}
  <!-- å¦‚æœæœ‰å¤šä¸ªæ¦œå•æ¨¡å¼å¯ä»¥åšåˆ‡æ¢ï¼›å…ˆç•™ä¸€ä¸ª -->
  <button class="lk-pill lk-pill-active">æ—¶é—´åŒé¢‘æ¦œ</button>
{% endblock %}

{% block ranking_desc %}
  å°‘äº 5 æ¬¡åŒ¹é…æ ·æœ¬ä¼šç•¥å¾®è¡°å‡ 15%ï¼Œ100% ä»…ä»£è¡¨å®Œç¾é‡å ç»“æ„ï¼Œå¤šæ¬¡éªŒè¯ã€‚
{% endblock %}

{% block ranking_list %}
  {% for item in leaderboard %}
  <div class="lk-ranking-item">
    <div class="lk-ranking-medal">No.{{ loop.index }}</div>
    <div class="lk-ranking-info">
      <div class="lk-ranking-name">çµå‹ #{{ item.friend_id }}</div>
      <div class="lk-ranking-meta">
        åŒ¹é… {{ item.match_count }} æ¬¡ Â· éªŒè¯ {{ item.verify_count }} æ¬¡
      </div>
    </div>
    <div class="lk-ranking-score">
      {{ item.final_score|default(0) }} <span class="lk-score-unit">%</span>
    </div>
  </div>
  {% endfor %}
{% endblock %}

{% block main_title %}æ—¶é—´åŒé¢‘ Â· æ¯«ç§’çº§ç»“æ„åŒ¹é…{% endblock %}

{% block main_subtitle %}
åŸºäºçœŸå¤ªé˜³æ—¶çš„æ—¶é—´å±‚çº§ç»“æ„ï¼Œè¿›è¡Œé¢‘ç‡åŒ¹é…è¯„åˆ†ï¼Œä¸åŒäºå…«å­—åŒå‘½ç®—æ³•ï¼Œåˆ†å€¼ä¸ºç»“æ„ç›¸ä¼¼åº¦å‚è€ƒæŒ‡æ ‡ã€‚
{% endblock %}

{% block content %}

  <!-- é¡¶éƒ¨è¯´æ˜ Banner -->
  <section class="lk-banner">
    <div class="lk-banner-icon">ğŸ’¡</div>
    <div class="lk-banner-body">
      <div class="lk-banner-title">æ’è¡Œæ¦œè¯„åˆ†è¯´æ˜</div>
      <div class="lk-banner-text">
        å½“å‰æ¦œå•åŸºäºçœŸå¤ªé˜³æ—¶ + æ¯«ç§’çº§æ—¶é—´ç»“æ„è¯„åˆ†ï¼Œå°‘äº 5 æ¬¡åŒ¹é…æ ·æœ¬å°†ç•¥å¾®è¡°å‡ 15%ï¼Œ100% ä»…ä¿ç•™å®Œå…¨é‡å ç»“æ„ï¼Œå¤šæ¬¡éªŒè¯ã€‚
      </div>
    </div>
  </section>

  <!-- ç­›é€‰æ¡ä»¶ -->
  <section class="lk-filter-bar">
    <div class="lk-filter-label">ç­›é€‰æ¡ä»¶ï¼ˆå¯è‡ªå®šä¹‰ï¼‰</div>
    <div class="lk-filter-pills">
      <!-- è¿™é‡Œä¿æŒä½ ç°åœ¨çš„å‹¾é€‰é€»è¾‘ï¼Œclass é‡Œå¯åŠ  active çŠ¶æ€ -->
      <button class="lk-pill {% if filters.same_year %}lk-pill-active{% endif %}"
              data-filter="same_year">åŒå¹´</button>
      <button class="lk-pill {% if filters.same_month %}lk-pill-active{% endif %}"
              data-filter="same_month">åŒæœˆ</button>
      <button class="lk-pill {% if filters.same_day %}lk-pill-active{% endif %}"
              data-filter="same_day">åŒæ—¥</button>
      <button class="lk-pill {% if filters.same_shichen %}lk-pill-active{% endif %}"
              data-filter="same_shichen">åŒæ—¶è¾°</button>
      <button class="lk-pill {% if filters.same_hour %}lk-pill-active{% endif %}"
              data-filter="same_hour">åŒå°æ—¶</button>
      <button class="lk-pill {% if filters.same_quarter %}lk-pill-active{% endif %}"
              data-filter="same_quarter">åŒåˆ»</button>
      <button class="lk-pill {% if filters.same_minute %}lk-pill-active{% endif %}"
              data-filter="same_minute">åŒåˆ†</button>
    </div>
    <div class="lk-filter-mode">
      å½“å‰é»˜è®¤æœç´¢æ¨¡å¼ï¼š<span class="lk-tag-primary">100% ç²¾å‡†åŒ¹é…</span>
    </div>
  </section>

  <!-- åŒ¹é…ç»“æœåˆ—è¡¨ -->
  <section class="lk-results">
    {% for match in matches %}
    <article class="lk-match-card">
      <div class="lk-match-header">
        <div class="lk-match-title">
          çµå‹ #{{ match.friend_id }}
        </div>
        <div class="lk-match-score-badge">
          {{ match.score }}% åŒé¢‘
        </div>
      </div>

      <div class="lk-match-meta">
        <span class="lk-match-meta-label">é¢‘ç‡ç»“æ„ï¼š</span>
        <span class="lk-match-meta-value">
          {{ match.summary|default("å®Œç¾åŒé¢‘") }}
        </span>
      </div>

      <div class="lk-match-tags">
        <!-- è¿™é‡Œå±•ç¤ºå·²å‘½ä¸­çš„å±‚çº§ï¼Œå¯æŒ‰ä½ ç°æœ‰çš„ç»“æ„è°ƒ -->
        {% if match.same_year %}<span class="lk-tag">åŒå¹´</span>{% endif %}
        {% if match.same_month %}<span class="lk-tag">åŒæœˆ</span>{% endif %}
        {% if match.same_day %}<span class="lk-tag">åŒæ—¥</span>{% endif %}
        {% if match.same_shichen %}<span class="lk-tag">åŒæ—¶è¾°</span>{% endif %}
        {% if match.same_hour %}<span class="lk-tag">åŒå°æ—¶</span>{% endif %}
        {% if match.same_quarter %}<span class="lk-tag">åŒåˆ»</span>{% endif %}
        {% if match.same_minute %}<span class="lk-tag">åŒåˆ†</span>{% endif %}
      </div>

      <div class="lk-match-footer">
        <button class="lk-btn lk-btn-primary"
                onclick="window.location.href='{{ url_for('modernmatch.modernmatch_detail', friend_id=match.friend_id) }}'">
          æŸ¥çœ‹è¯¦æƒ…
        </button>
        <button class="lk-btn lk-btn-ghost">
          æ‰“æ‹›å‘¼
        </button>
      </div>
    </article>
    {% else %}
      <div class="lk-empty">æš‚æ— åŒ¹é…ç»“æœï¼Œå¯ä»¥æ”¾å®½ç­›é€‰æ¡ä»¶è¯•è¯•ã€‚</div>
    {% endfor %}
  </section>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Match - Lynker AI</title>
    <style>
        /* Unified UI System for Lynker Bazi Engine - INLINED for Reliability */
        :root {
            --bg-gradient: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 40%, #16213e 100%);
            --card-bg: rgba(255, 255, 255, 0.03);
            --card-border: rgba(255, 255, 255, 0.08);
            --text-primary: #e8e8e8;
            --text-secondary: rgba(255, 255, 255, 0.5);
            --accent-gold: #e0c3a8;
            --accent-purple: #9d8ec4;
            --accent-purple-hover: #b3a4d8;
            --glass-blur: blur(20px);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        /* Left Profile Card */
        .profile-card {
            background: var(--card-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            padding: 30px;
            text-align: center;
            position: sticky;
            top: 20px;
            height: fit-content;
            box-shadow: var(--shadow-card);
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, #333, #555);
            margin: 0 auto 20px;
            border: 2px solid var(--accent-gold);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #fff;
            overflow: hidden;
        }
        
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 8px;
        }

        .user-uid {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 24px;
            letter-spacing: 1px;
        }

        .profile-info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 13px;
        }

        .profile-info-item:last-child { border-bottom: none; }
        .profile-info-item .label { color: var(--text-secondary); }
        .profile-info-item .value { color: #fff; font-weight: 500; }

        .back-btn {
            display: block;
            margin-top: 30px;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s;
            font-size: 13px;
        }

        .back-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
            background: rgba(224, 195, 168, 0.05);
        }

        /* Right Content Area */
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .page-header {
            margin-bottom: 10px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 500;
            color: var(--accent-gold);
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            letter-spacing: 1px;
        }

        /* Score Hint Box */
        .score-hint-box {
            background: rgba(224, 195, 168, 0.05);
            border: 1px solid rgba(224, 195, 168, 0.15);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .hint-icon { font-size: 24px; }
        .hint-text { font-size: 13px; color: rgba(255,255,255,0.8); line-height: 1.5; }

        /* Filters */
        .filter-section {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 20px;
            border-radius: 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: rgba(157, 142, 196, 0.1);
            color: var(--accent-purple);
            border-color: var(--accent-purple);
        }

        .filter-btn.active {
            background: var(--accent-purple);
            color: #fff;
            border-color: var(--accent-purple);
            box-shadow: 0 4px 12px rgba(157, 142, 196, 0.3);
        }

        /* Match List Grid */
        .match-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        /* Match Card */
        .match-card {
            background: var(--card-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .match-card:hover {
            transform: translateY(-5px);
            border-color: rgba(224, 195, 168, 0.3);
            box-shadow: var(--shadow-card);
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .match-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .match-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #fff;
        }

        .match-info h3 {
            font-size: 16px;
            color: #fff;
            margin-bottom: 4px;
        }

        .match-info p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .match-score {
            text-align: right;
        }

        .score-val {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-gold);
            line-height: 1;
        }

        .score-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .match-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tag {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 6px;
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.7);
        }

        .tag.highlight {
            background: rgba(224, 195, 168, 0.15);
            color: var(--accent-gold);
            border: 1px solid rgba(224, 195, 168, 0.2);
        }

        .card-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .action-btn {
            padding: 10px;
            border-radius: 10px;
            border: none;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            text-decoration: none;
        }

        .btn-view {
            background: rgba(255,255,255,0.05);
            color: #fff;
        }

        .btn-view:hover {
            background: rgba(255,255,255,0.1);
        }

        .btn-hi {
            background: linear-gradient(135deg, #e0c3a8 0%, #c9a87e 100%);
            color: #1a1a2e;
            font-weight: 600;
        }

        .btn-hi:hover {
            box-shadow: 0 4px 15px rgba(224, 195, 168, 0.3);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            .profile-card {
                position: relative;
                top: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Profile Card -->
        <div class="profile-card">
            <div class="avatar">
                {{ birth_data.name[0] if birth_data.name else 'U' }}
            </div>
            <h2 class="user-name">{{ birth_data.name or 'Unknown' }}</h2>
            <p class="user-uid">UID: 8829301</p>
            
            <div class="profile-info-item">
                <span class="label">æ€§åˆ«</span>
                <span class="value">{{ 'ç”·' if birth_data.gender == 'male' else 'å¥³' }}</span>
            </div>
            <div class="profile-info-item">
                <span class="label">å‡ºç”Ÿåœ°</span>
                <span class="value">{{ birth_data.location.name }}</span>
            </div>
            <div class="profile-info-item">
                <span class="label">çœŸå¤ªé˜³æ—¶</span>
                <span class="value">{{ birth_data.true_solar_datetime[:10] }}</span>
            </div>
            <div class="profile-info-item">
                <span class="label">æ—¶é—´</span>
                <span class="value">{{ birth_data.true_solar_datetime[11:16] }}</span>
            </div>
            <div class="profile-info-item">
                <span class="label">æ—¶è¾°</span>
                <span class="value">{{ birth_data.shichen }}æ—¶</span>
            </div>

            <a href="/dashboard" class="back-btn">â† è¿”å›æ€»è§ˆ</a>
        </div>

        <!-- Right Content Area -->
        <div class="content-area">
            <div class="page-header">
                <h1 class="page-title">Modern Match</h1>
                <p class="page-subtitle">Time Frequency Synchronization Â· ç°ä»£æ—¶é—´åŒé¢‘</p>
            </div>

            <!-- Score Hint -->
            <div class="score-hint-box">
                <div class="hint-icon">ğŸ’¡</div>
                <div class="hint-text">
                    æ‚¨çš„æ—¶é—´é¢‘ç‡ç»“æ„æ˜¾ç¤ºå‡ºç½•è§çš„â€œé¾™è™â€å…±æŒ¯æ¨¡å¼ã€‚
                    æ‚¨ä¸å‡ºç”Ÿåœ¨<strong>çŒ´å¹´</strong>æˆ–<strong>é¼ å¹´</strong>çš„äººé«˜åº¦å…¼å®¹ã€‚
                </div>
            </div>

            <!-- Filters -->
            <div class="filter-section">
                <button class="filter-btn active">å…¨éƒ¨åŒ¹é…</button>
                <button class="filter-btn">åŒå¹´</button>
                <button class="filter-btn">åŒæœˆ</button>
                <button class="filter-btn">åŒæ—¥</button>
                <button class="filter-btn">åŒæ—¶è¾°</button>
            </div>

            <!-- Match List -->
            <div class="match-list">
                <!-- Mock Match 1 -->
                <div class="match-card">
                    <div class="match-header">
                        <div class="match-user">
                            <div class="match-avatar" style="background: #4a90e2;">æ</div>
                            <div class="match-info">
                                <h3>ææ˜</h3>
                                <p>åŒ—äº¬ Â· 1995</p>
                            </div>
                        </div>
                        <div class="match-score">
                            <div class="score-val">98</div>
                            <div class="score-label">åŒ¹é…åº¦</div>
                        </div>
                    </div>
                    <div class="match-tags">
                        <span class="tag highlight">åŒå¹´</span>
                        <span class="tag highlight">åŒæœˆ</span>
                        <span class="tag">é‡‘æ—¥ä¸»</span>
                    </div>
                    <div class="card-actions">
                        <button class="action-btn btn-view">æŸ¥çœ‹æ¡£æ¡ˆ</button>
                        <button class="action-btn btn-hi">æ‰“æ‹›å‘¼</button>
                    </div>
                </div>

                <!-- Mock Match 2 -->
                <div class="match-card">
                    <div class="match-header">
                        <div class="match-user">
                            <div class="match-avatar" style="background: #e24a90;">é™ˆ</div>
                            <div class="match-info">
                                <h3>é™ˆèè</h3>
                                <p>ä¸Šæµ· Â· 1998</p>
                            </div>
                        </div>
                        <div class="match-score">
                            <div class="score-val">92</div>
                            <div class="score-label">åŒ¹é…åº¦</div>
                        </div>
                    </div>
                    <div class="match-tags">
                        <span class="tag highlight">åŒæ—¥</span>
                        <span class="tag">æ°´å…ƒç´ </span>
                    </div>
                    <div class="card-actions">
                        <button class="action-btn btn-view">æŸ¥çœ‹æ¡£æ¡ˆ</button>
                        <button class="action-btn btn-hi">æ‰“æ‹›å‘¼</button>
                    </div>
                </div>

                <!-- Mock Match 3 -->
                <div class="match-card">
                    <div class="match-header">
                        <div class="match-user">
                            <div class="match-avatar" style="background: #50e3c2; color: #333;">å´</div>
                            <div class="match-info">
                                <h3>David Wu</h3>
                                <p>æ–°åŠ å¡ Â· 1992</p>
                            </div>
                        </div>
                        <div class="match-score">
                            <div class="score-val">88</div>
                            <div class="score-label">åŒ¹é…åº¦</div>
                        </div>
                    </div>
                    <div class="match-tags">
                        <span class="tag highlight">åŒæ—¶è¾°</span>
                        <span class="tag">åœŸç»“æ„</span>
                    </div>
                    <div class="card-actions">
                        <button class="action-btn btn-view">æŸ¥çœ‹æ¡£æ¡ˆ</button>
                        <button class="action-btn btn-hi">æ‰“æ‹›å‘¼</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}