<!DOCTYPE html>
<html lang="en">
{% extends "base_dark.html" %}

{% block title %}åŒå‘½åŒ¹é… Â· å…«å­—åŒé¢‘æœç´¢{% endblock %}

{% block ranking_title %}åŒé¢‘æ’è¡Œæ¦œ Â· BaziMatchAgent{% endblock %}

{% block ranking_tabs %}
  <button class="lk-pill lk-pill-active">å…«å­—åŒé¢‘æ¦œ</button>
{% endblock %}

{% block ranking_desc %}
æœ¬æ¦œåŸºäºä¼ ç»Ÿå…«å­—å››æŸ±ç»“æ„åŒ¹é…ï¼Œä¸é‡‡ç”¨ç°ä»£ç§’çº§æ—¶é—´ç®—æ³•ã€‚
{% endblock %}

{% block ranking_list %}
  {% for item in leaderboard %}
  <div class="lk-ranking-item">
    <div class="lk-ranking-medal">No.{{ loop.index }}</div>
    <div class="lk-ranking-info">
      <div class="lk-ranking-name">çµå‹ #{{ item.friend_id }}</div>
      <div class="lk-ranking-meta">
        åŒ¹é… {{ item.match_count }} æ¬¡ Â· éªŒè¯ {{ item.verify_count }} æ¬¡
      </div>
    </div>
    <div class="lk-ranking-score">
      {{ item.final_score|default(0) }}<span class="lk-score-unit">%</span>
    </div>
  </div>
  {% endfor %}
{% endblock %}

{% block main_title %}åŒå‘½åŒ¹é… Â· å…«å­—åŒé¢‘æœç´¢{% endblock %}

{% block main_subtitle %}
åŸºäºå¤©å¹²åœ°æ”¯ç»“æ„çš„çµé­‚çº§åŒ¹é…å¼•æ“ï¼Œä»…åœ¨å››æŸ±å®Œå…¨ä¸€è‡´æ—¶åˆ¤ä¸º 100% åŒå‘½ã€‚
{% endblock %}

{% block content %}

  <section class="lk-banner">
    <div class="lk-banner-icon">ğŸ’¡</div>
    <div class="lk-banner-body">
      <div class="lk-banner-title">è¯„åˆ†è¯´æ˜</div>
      <div class="lk-banner-text">
        æ­¤è¯„åˆ†å‚è€ƒå…«å­—å››æŸ±åŒ¹é…ç³»æ•°ï¼ˆå¹´æŸ± 20 åˆ†ï½å¹´æŸ± 40 åˆ†ã€å¹´æœˆæ—¥ 70 åˆ†ï½å¹´æœˆæ—¥æ—¶ 100 åˆ†ï¼‰ï¼Œä»…åœ¨å››æŸ±å®Œå…¨ä¸€è‡´æ—¶ä¸ºçœŸæ­£"åŒå‘½"ã€‚
        ä½ å¯åœ¨ <span class="lk-tag-primary">æ—¶é—´åŒé¢‘æ¨¡ç»„</span> ä¸­å¯¹æ¯”ä¸åŒä½“ç³»ã€‚
      </div>
    </div>
  </section>

  <section class="lk-filter-bar">
    <div class="lk-filter-label">ç­›é€‰æ¡ä»¶ï¼ˆå¯è‡ªå®šä¹‰ï¼‰</div>
    <div class="lk-filter-pills">
      <button class="lk-pill {% if filters.same_year_pillar %}lk-pill-active{% endif %}">åŒå¹´æŸ±</button>
      <button class="lk-pill {% if filters.same_month_pillar %}lk-pill-active{% endif %}">åŒæœˆæŸ±</button>
      <button class="lk-pill {% if filters.same_day_pillar %}lk-pill-active{% endif %}">åŒæ—¥æŸ±</button>
      <button class="lk-pill {% if filters.same_hour_pillar %}lk-pill-active{% endif %}">åŒæ—¶æŸ±</button>
      <button class="lk-pill {% if filters.same_stem_structure %}lk-pill-active{% endif %}">åŒå¤©å¹²ç»“æ„</button>
      <button class="lk-pill {% if filters.same_branch_structure %}lk-pill-active{% endif %}">åŒåœ°æ”¯ç»“æ„</button>
      <button class="lk-pill {% if filters.same_pattern %}lk-pill-active{% endif %}">åŒæ ¼å±€</button>
      <button class="lk-pill {% if filters.same_yongshen %}lk-pill-active{% endif %}">åŒç”¨ç¥</button>
    </div>
    <div class="lk-filter-mode">
      å®½æ¾åŒ¹é…æ¨¡å¼ï¼š<span class="lk-tag-primary">{{ active_mode_label|default("7 é¡¹æ¡ä»¶ç”Ÿæ•ˆ") }}</span>
    </div>
  </section>

  <section class="lk-results">
    {% for match in matches %}
    <article class="lk-match-card">
      <div class="lk-match-header">
        <div class="lk-match-title">
          çµå‹ #{{ match.friend_id }}
        </div>
        <div class="lk-match-score-badge">
          {{ match.score }} åˆ†åŒ¹é…
        </div>
      </div>

      <div class="lk-match-meta">
        <span class="lk-match-meta-label">å…«å­—é¢‘ç‡ç ï¼š</span>
        <span class="lk-match-meta-value">
          {{ match.bazi_code }}  <!-- æ¯”å¦‚ï¼šåºšè¾°Â·æˆŠå¯…Â·ä¸æœªÂ·å£¬å­ -->
        </span>
      </div>

      <div class="lk-match-tags">
        {% if match.same_year_pillar %}<span class="lk-tag">åŒå¹´æŸ±</span>{% endif %}
        {% if match.same_month_pillar %}<span class="lk-tag">åŒæœˆæŸ±</span>{% endif %}
        {% if match.same_day_pillar %}<span class="lk-tag">åŒæ—¥æŸ±</span>{% endif %}
        {% if match.same_hour_pillar %}<span class="lk-tag">åŒæ—¶æŸ±</span>{% endif %}
        {% if match.same_stem_structure %}<span class="lk-tag">åŒå¤©å¹²ç»“æ„</span>{% endif %}
        {% if match.same_branch_structure %}<span class="lk-tag">åŒåœ°æ”¯ç»“æ„</span>{% endif %}
        {% if match.same_pattern %}<span class="lk-tag">åŒæ ¼å±€</span>{% endif %}
        {% if match.same_yongshen %}<span class="lk-tag">åŒç”¨ç¥</span>{% endif %}
      </div>

      <div class="lk-match-footer">
        <button class="lk-btn lk-btn-primary"
                onclick="window.location.href='{{ url_for('bazi.bazi_detail', friend_id=match.friend_id) }}'">
          æŸ¥çœ‹å‘½ç›˜
        </button>
        <button class="lk-btn lk-btn-ghost">
          æ‰“æ‹›å‘¼
        </button>
      </div>
    </article>
    {% else %}
      <div class="lk-empty">æš‚æ— åŒ¹é…ç»“æœã€‚</div>
    {% endfor %}
  </section>

{% endblock %}
