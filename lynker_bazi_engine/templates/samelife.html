<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ—¶é—´åŒé¢‘ Â· çµå®¢AI</title>
    <link rel="stylesheet" href="{{ url_for('bazi.static', filename='css/samelife.css') }}?v=11" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        /* Logo å·¦ä¸Šè§’ */
        .brand-logo {
            position: fixed;
            top: 20px;
            left: 24px;
            font-size: 20px;
            font-weight: 800;
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s ease;
        }
        .brand-logo:hover {
            transform: scale(1.05);
        }
        .brand-logo::before {
            content: 'âœ¦';
            font-size: 18px;
        }
    </style>
    <script>
        const API_BASE = "{{ url_for('bazi.index') }}".replace(/\/$/, '');
    </script>
</head>

<body>
    <!-- Logo -->
    <a href="/landing.html" class="brand-logo">çµå®¢AI</a>

    <div class="layout-container">

        <!-- å·¦ä¾§è¾¹æ ï¼šæ ¸å¿ƒä¿¡æ¯åŒº -->
        <aside class="sidebar">

            <!-- 1. é«˜äº®ç”¨æˆ·å‘½ç›˜å¡ç‰‡(åŠ¨æ€æ•°æ®) -->
            <div class="user-profile-card">
                <div class="profile-user-info">
                    <div class="user-avatar-large">
                        <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop"
                            alt="User Avatar" id="userAvatar" class="profile-avatar">
                    </div>
                    <div class="profile-name" id="userName">çµå‹</div>
                    <div class="profile-uid" id="userUid">UID: ---</div>
                </div>

                <div class="profile-header">CURRENT CHART</div>

                <div class="profile-item">
                    <div class="profile-label">å‡ºç”Ÿæ—¶é—´</div>
                    <div class="profile-value" id="birthTime">---</div>
                </div>

                <div class="profile-item">
                    <div class="profile-label">çœŸå¤ªé˜³æ—¶</div>
                    <div class="profile-value" id="trueTime">---</div>
                </div>
                
                <a href="/bazi/birth-input" class="btn-reinput">é‡æ–°è¾“å…¥</a>
            </div>

            <!-- 2. æ’è¡Œæ¦œ -->
            <div class="leaderboard-card">
                <h2 class="section-title">ğŸ† æ—¶é—´åŒé¢‘æ’è¡Œæ¦œ</h2>
                
                <!-- åŒæ¦œåˆ‡æ¢ -->
                <div class="leaderboard-tabs">
                    <div class="tab-item active" data-engine="time" onclick="switchLeaderboard('time')">
                        â±ï¸ æ—¶é—´åŒé¢‘
                    </div>
                    <div class="tab-item" data-engine="bazi" onclick="switchLeaderboard('bazi')">
                        ğŸ”® å…«å­—åŒå‘½
                    </div>
                </div>
                
                <div class="leaderboard-desc" id="leaderboardDesc">
                    åŸºäºçœŸå¤ªé˜³æ—¶ + ç§’çº§æ—¶é—´ç»“æ„è¿›è¡ŒåŒé¢‘è¯„åˆ†
                </div>
                
                <div id="weight-version" class="weight-tag" style="display:none"></div>
                <div id="leaderboardList" class="leaderboard-list">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>

        </aside>

        <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
        <main class="main-content">

            <div class="page-header">
                <h1>æ—¶é—´åŒé¢‘ Â· ç§’çº§ç»“æ„åŒ¹é…</h1>
                <p class="desc">åŸºäºçœŸå¤ªé˜³æ—¶çš„ç²¾å‡†åŒé¢‘æœç´¢å¼•æ“</p>
            </div>

            <!-- ç­›é€‰æ§åˆ¶é¢æ¿ -->
            <div class="filter-panel">
                <!-- è¯„åˆ†ä½“ç³»è¯´æ˜ -->
                <div>
                    <strong>âš¡ æ’è¡Œæ¦œè¯„åˆ†è¯´æ˜</strong><br>
                    å½“å‰æ¦œå•åŸºäº<strong>çœŸå¤ªé˜³æ—¶ + ç§’çº§æ—¶é—´ç»“æ„</strong>è¿›è¡ŒåŒé¢‘è¯„åˆ†ï¼Œä¸åŒäºå…«å­—åŒå‘½ç®—æ³•ï¼Œåˆ†å€¼ä¸ºç»“æ„ç›¸ä¼¼åº¦å‚è€ƒæŒ‡æ ‡ã€‚<br>
                    <span style="font-size:11px;opacity:0.8;">æ³¨ï¼šå°‘äº5æ¬¡åŒ¹é…æ ·æœ¬å°†è‡ªåŠ¨é™æƒ15%ï¼Œ100%ä»…é™å®Œç¾åŒ¹é…+å¤šæ¬¡éªŒè¯ã€‚</span>
                </div>

                <div id="filter-status" class="filter-status">
                    å½“å‰é»˜è®¤æœç´¢æ¨¡å¼ï¼š100% ç²¾å‡†åŒ¹é…
                </div>

                <div class="filter-section">
                    <div>ç­›é€‰æ¡ä»¶ï¼ˆå¯è‡ªå®šä¹‰ï¼‰</div>
                    <div id="match-criteria" class="match-criteria-bar"></div>
                </div>
            </div>

            <!-- åŒ¹é…ç»“æœåˆ—è¡¨ -->
            <div id="matchList" class="list"></div>

        </main>

    </div>

    <script src="{{ url_for('bazi.static', filename='js/samelife.js') }}?v=11"></script>
    <script>
        // åŒæ¦œåˆ‡æ¢åŠŸèƒ½
        let currentEngine = 'time';
        
        function switchLeaderboard(engine) {
            currentEngine = engine;
            
            // æ›´æ–° Tab æ ·å¼
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.engine === engine) {
                    tab.classList.add('active');
                }
            });
            
            // æ›´æ–°æè¿°
            const descEl = document.getElementById('leaderboardDesc');
            if (engine === 'time') {
                descEl.textContent = 'åŸºäºçœŸå¤ªé˜³æ—¶ + ç§’çº§æ—¶é—´ç»“æ„è¿›è¡ŒåŒé¢‘è¯„åˆ†';
            } else {
                descEl.textContent = 'åŸºäºå…«å­—å‘½ç›˜ç»“æ„è¿›è¡ŒåŒå‘½åŒ¹é…è¯„åˆ†';
            }
            
            // é‡æ–°åŠ è½½æ’è¡Œæ¦œ
            loadLeaderboard(engine);
        }
        
        async function loadLeaderboard(engine) {
            const listEl = document.getElementById('leaderboardList');
            listEl.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            try {
                const resp = await fetch(`${API_BASE}/api/leaderboard/top?limit=5&engine=${engine}`);
                const data = await resp.json();
                
                if (data.leaderboard && data.leaderboard.length > 0) {
                    listEl.innerHTML = data.leaderboard.map((item, idx) => `
                        <div class="rank-item">
                            <div class="rank-icon">${idx < 3 ? ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][idx] : (idx + 1)}</div>
                            <div class="rank-info">
                                <div class="rank-user">${item.nickname || 'åŒ¿åç”¨æˆ·'}</div>
                                <div class="rank-stats">${item.match_count || 0} æ¬¡åŒ¹é…</div>
                            </div>
                            <div class="rank-score">${(item.score * 100).toFixed(1)}%</div>
                        </div>
                    `).join('');
                } else {
                    listEl.innerHTML = '<div class="loading">æš‚æ— æ’è¡Œæ•°æ®</div>';
                }
            } catch (e) {
                listEl.innerHTML = '<div class="loading">åŠ è½½å¤±è´¥</div>';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadLeaderboard('time');
        });
    </script>

</body>

</html>
